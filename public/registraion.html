<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSI Student Registration</title>
  <link rel="stylesheet" href="css/reg.css">
  <link rel="shortcut icon" href="assets/OIP.svg" type="image/x-icon">
  <style>
    /* Minimal styling for modal and error */
    .error input, .error select { border: 2px solid red; }
    .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; }
    .modal-overlay.show { display: flex; }
    .modal { background: #fff; padding: 20px; border-radius: 8px; max-width: 400px; width: 90%; text-align:center; }
    .success-icon { font-size: 2rem; color: green; margin-bottom: 10px; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo-section">
      <div class="logo-placeholder">CSI</div>
      <h1 class="page-title">Student Registration</h1>
      <p class="page-subtitle">Join the Computer Society of India - Your Gateway to Tech Excellence</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="form-container">
      
      <!-- Personal Information -->
      <section class="form-section">
        <h2 class="section-title">Personal Information</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" placeholder="Enter your complete name" required>
          </div>
          <div class="form-group">
            <label for="mobile">Mobile Number</label>
            <input type="tel" id="mobile" placeholder="10-digit mobile number" pattern="[0-9]{10}" required>
          </div>
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" placeholder="Enter your email" required>
          </div>
        </div>
      </section>

      <!-- Academic Details -->
      <section class="form-section">
        <h2 class="section-title">Academic Details</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="year">Academic Year</label>
            <select id="year" required>
              <option value="">Select your current year</option>
              <option value="1">1st Year</option>
              <option value="2">2nd Year</option>
              <option value="3">3rd Year</option>
              <option value="4">4th Year</option>
            </select>
          </div>
          <div class="form-group">
            <label for="branch">Branch/Specialization</label>
            <input type="text" id="branch" placeholder="e.g., Computer Science Engineering" required>
          </div>
        </div>
      </section>

      <!-- Registration Details -->
      <section class="form-section">
        <h2 class="section-title">Registration Details</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="amount">Registration Amount</label>
            <input type="number" id="amount" placeholder="Amount paid in ₹" required min="0">
          </div>
        </div>

        <!-- Status Selection -->
        <div class="radio-section">
          <h3 class="section-title">Registration Status</h3>
          <div class="radio-group">
            <div class="radio-option selected" data-value="interested">
              <input type="radio" id="interested" name="status" value="interested" checked>
              <label for="interested">Interested</label>
            </div>
            <div class="radio-option" data-value="registered">
              <input type="radio" id="registered" name="status" value="registered">
              <label for="registered">Registered</label>
            </div>
          </div>
        </div>
      </section>

      <!-- Submit -->
      <section class="submit-section">
        <button id="submitBtn"><span class="btn-text">Complete Registration</span></button>
      </section>
    </div>
  </main>

  <!-- Modal -->
  <div id="modalOverlay" class="modal-overlay">
    <div class="modal">
      <div id="modalIcon" class="success-icon">✓</div>
      <h3 id="modalTitle">Success!</h3>
      <p id="modalMsg">Your registration has been submitted successfully.</p>
      <button id="modalClose">Continue</button>
    </div>
  </div>

  <script>
    const btn = document.getElementById('submitBtn');
    const btnText = document.querySelector('.btn-text');
    const modalOverlay = document.getElementById('modalOverlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalMsg = document.getElementById('modalMsg');
    const modalIcon = document.getElementById('modalIcon');
    const modalClose = document.getElementById('modalClose');

    // Radio selection
    document.querySelectorAll('.radio-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        option.querySelector('input[type="radio"]').checked = true;
      });
    });

    // Validation
    function validateForm() {
      let isValid = true;
      const fields = ['name', 'year', 'branch', 'amount', 'mobile', 'email'];
      fields.forEach(id => {
        const field = document.getElementById(id);
        const formGroup = field.closest('.form-group');
        if (!field.value.trim() || (id==='mobile' && !/^\d{10}$/.test(field.value.trim()))) {
          formGroup.classList.add('error');
          isValid = false;
        } else {
          formGroup.classList.remove('error');
        }
      });
      return isValid;
    }

    function showModal(title, msg, isSuccess=true) {
      modalTitle.textContent = title;
      modalMsg.textContent = msg;
      modalIcon.textContent = isSuccess ? '✓' : '✗';
      modalIcon.style.color = isSuccess ? 'green' : 'red';
      modalOverlay.classList.add('show');
    }

    function hideModal() { modalOverlay.classList.remove('show'); }
    modalClose.addEventListener('click', hideModal);
    modalOverlay.addEventListener('click', e => { if(e.target===modalOverlay) hideModal(); });

    // Remove error on input
    document.querySelectorAll('input, select').forEach(f => f.addEventListener('input', () => {
      f.closest('.form-group').classList.remove('error');
    }));

    btn.addEventListener('click', async () => {
      if(!validateForm()) {
        showModal('Validation Error', 'Please fill in all fields correctly.', false);
        const firstError = document.querySelector('.form-group.error');
        if(firstError) firstError.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }

      // Collect form data
      const data = {
        studentName: document.getElementById('name').value.trim(),
        year: document.getElementById('year').value,
        branch: document.getElementById('branch').value.trim(),
        amountPaid: document.getElementById('amount').value,
        mobileNumber: document.getElementById('mobile').value.trim(),
        email: document.getElementById('email').value.trim(),
        status: document.querySelector('input[name="status"]:checked').value
      };

      btn.disabled = true;
      btnText.innerHTML = 'Processing Registration...';

      try {
        const fd = new FormData();
        for (const key in data) fd.append(key, data[key]);

        const res = await fetch(`https://csi-uyhe.onrender.com/studentdetails?option=${data.status}`, {
          method: 'POST', body: fd
        });

        if(!res.ok) {
          const text = await res.text().catch(()=>'Server error');
          showModal('Submission Failed', text, false);
          return;
        }

        showModal('Registration Complete!', 'Welcome to CSI! Your registration has been processed successfully.', true);

        // Reset form
        document.querySelectorAll('input').forEach(i => i.value='');
        document.getElementById('year').value='';
        document.getElementById('interested').checked = true;
        document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
        document.querySelector('[data-value="interested"]').classList.add('selected');
        window.scrollTo({top:0, behavior:'smooth'});

      } catch(err) {
        showModal('Network Error', 'Unable to connect to server.', false);
      } finally {
        btn.disabled = false;
        btnText.textContent = 'Complete Registration';
      }
    });
  </script>
</body>
</html>
